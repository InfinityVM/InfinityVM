#!/bin/bash

RPC_URL=${RPC_URL:-http://localhost:8545}
CHAIN_ID=${CHAIN_ID:-31337}
PRIVATE_KEY=${PRIVATE_KEY:-0c7ec7aefb80022c0025be1e72dadb0679aa294cb1db453b2e7b5da8616b4e31}
# ABI-encoded request + result + signatures can be generated using crates/scripts/signer.rs
# (these need to be re-generated every time the consumer address changes)
OFFCHAIN_RESULT_WITH_METADATA=${1:-"9a100e62829cbc6e07b8fc55253407eebd411b342b7781ac585b2688a9e359c4fc7fea3498733d20c11a0cf2984b78f88b954525730657cd0283d747479b3d6a00000000000000000000000000000000000000000000000000000000000f424000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000970726f6772616d494400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000a5889624184923c0c4cfc3499cbea659e34f7809000000000000000000000000000000000000000000000000000000000000000a"}
SIGNATURE_ON_RESULT=${2:-"e8f5d7a1e8b4363e950879075d7a7e77d4b1b3e0f4f1c898371c057677500d476d1b50bc4f99334162358fb1ff5a3897f9d84ee35417e78afe748792d681ab1c1c"}
JOB_REQUEST=${3:-"000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000f4240000000000000000000000000cf7ed3acca5a467e9e704c703e8d87f634fb0fc900000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000970726f6772616d4944000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000"}
SIGNATURE_ON_REQUEST=${4:-"b3eaa3283db39bf2de4f91037a7c2544101ad59d8e935c90ab2ae18b09d3988734b3a3bddb24ce0bb52b15e852fbadff36d69dc1e950c3516dee4bf76022a33e1b"}

# cd to the directory of this script so that this can be run from anywhere
parent_path=$( cd "$(dirname "${BASH_SOURCE[0]}")" ; pwd -P )
cd "$parent_path"

forge script ../SubmitResultForOffchainJob.s.sol:SubmitResultForOffchainJob --sig "submitResultForOffchainJob(bytes calldata offchainResultWithMetadata, bytes calldata signatureOnResult, bytes calldata jobRequest, bytes calldata signatureOnRequest)" $OFFCHAIN_RESULT_WITH_METADATA $SIGNATURE_ON_RESULT $JOB_REQUEST $SIGNATURE_ON_REQUEST --rpc-url $RPC_URL --private-key $PRIVATE_KEY --chain-id $CHAIN_ID --broadcast -v
